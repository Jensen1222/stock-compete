<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全股票AI分析助手</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --text-color: #1f2937;
            --light-bg: #f9fafb;
            --dark-bg: #1f2937;
            --user-bubble: #2563eb;
            --ai-bubble: #e5e7eb;
            --error-color: #dc2626;
        }
       
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
       
        body {
            background-color: #f3f4f6;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
       
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: 100vh;
            width: 100%;
        }
       
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }
       
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
       
        .logo i {
            font-size: 1.75rem;
            color: white;
        }
       
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
       
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background-color: var(--light-bg);
        }
       
        .message {
            display: flex;
            gap: 1rem;
            max-width: 90%;
        }
       
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
       
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: white;
            font-size: 1.25rem;
        }
       
        .user .message-avatar {
            background-color: var(--primary-color);
        }
       
        .ai .message-avatar {
            background-color: #6b7280;
        }
       
        .message-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
       
        .message-bubble {
            padding: 1rem;
            border-radius: 1rem;
            line-height: 1.6;
            font-size: 1rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
       
        .user .message-bubble {
            background-color: var(--user-bubble);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
       
        .ai .message-bubble {
            background-color: var(--ai-bubble);
            color: var(--text-color);
            border-bottom-left-radius: 0.25rem;
        }
       
        .message-time {
            font-size: 0.75rem;
            color: #6b7280;
        }
       
        .user .message-time {
            text-align: right;
        }
       
        .input-container {
            padding: 1rem;
            background-color: white;
            border-top: 1px solid #e5e7eb;
            position: relative;
        }
       
        .input-area {
            display: flex;
            gap: 0.75rem;
        }
       
        .input-box {
            flex: 1;
            border: 1px solid #e5e7eb;
            border-radius: 1.5rem;
            padding: 0.75rem 1.25rem;
            font-size: 1rem;
            resize: none;
            min-height: 50px;
            max-height: 150px;
            outline: none;
            transition: border-color 0.2s;
        }
       
        .input-box:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
       
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }
       
        .send-btn:hover {
            background-color: var(--secondary-color);
        }
       
        .send-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
       
        .stock-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
       
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
       
        .stock-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
       
        .stock-ticker {
            color: #6b7280;
            font-size: 0.9rem;
        }
       
        .stock-price {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
       
        .stock-change {
            font-size: 0.9rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
        }
       
        .positive {
            color: #16a34a;
            background-color: #dcfce7;
        }
       
        .negative {
            color: #dc2626;
            background-color: #fee2e2;
        }
       
        .stock-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 0.75rem;
        }
       
        .detail-item {
            font-size: 0.9rem;
        }
       
        .detail-label {
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
       
        .detail-value {
            font-weight: 500;
        }
       
        .loading-dots {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
        }
       
        .loading-dots span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #9ca3af;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
       
        .loading-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }
       
        .loading-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }
       
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
       
        .error-message {
            color: var(--error-color);
            background-color: #fee2e2;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            display: none;
        }
       
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
        }
       
        .suggestion-btn {
            background-color: #e5e7eb;
            border: none;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
       
        .suggestion-btn:hover {
            background-color: #d1d5db;
        }
       
        @media (max-width: 768px) {
            .container {
                height: 100vh;
            }
           
            .message {
                max-width: 100%;
            }
           
            .stock-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>全股票AI分析助手</h1>
            </div>
        </header>
       
        <div class="chat-container" id="chat-container">
            <!-- 初始歡迎消息 -->
            <div class="message ai">
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <p>您好！我是您的全股票AI分析助手，可以為您提供任何上市公司的專業分析。</p>
                        <p>您可以詢問：</p>
                        <ul>
                            <li>個股基本面分析（財務報表、估值等）</li>
                            <li>技術面分析（K線、指標等）</li>
                            <li>產業趨勢與競爭分析</li>
                            <li>投資建議與風險評估</li>
                        </ul>
                        <p>請輸入您想查詢的股票名稱或代碼開始對話！</p>
                    </div>
                    <div class="message-time" id="current-time"></div>
                   
                    <div class="suggestions">
                        <button class="suggestion-btn">台積電(2330)的財務狀況如何？</button>
                        <button class="suggestion-btn">分析聯發科(2454)的技術面</button>
                        <button class="suggestion-btn">比較台積電和英特爾的競爭優勢</button>
                        <button class="suggestion-btn">半導體產業的未來趨勢</button>
                    </div>
                </div>
            </div>
        </div>
       
        <div class="input-container">
            <div class="input-area">
                <textarea class="input-box" id="input-box" placeholder="輸入您的股票問題，例如：台積電(2330)的未來成長潛力如何？" rows="1"></textarea>
                <button class="send-btn" id="send-btn" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
           
            <div class="error-message" id="error-message">
                發生錯誤：無法連接AI服務。請檢查網路連接後重試。
            </div>
           
            <div class="suggestions" id="quick-suggestions">
                <button class="suggestion-btn">AAPL最近的股價表現</button>
                <button class="suggestion-btn">TSM的技術分析</button>
                <button class="suggestion-btn">美股大盤走勢預測</button>
            </div>
        </div>
    </div>
 
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const inputBox = document.getElementById('input-box');
            const sendBtn = document.getElementById('send-btn');
            const errorMessage = document.getElementById('error-message');
            const quickSuggestions = document.getElementById('quick-suggestions');
           
            // 更新當前時間
            function updateCurrentTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-TW', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('current-time').textContent = timeString;
            }
           
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);
           
            // 自動調整輸入框高度
            inputBox.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
               
                // 啟用/禁用發送按鈕
                sendBtn.disabled = this.value.trim() === '';
            });
           
            // 發送消息
            async function sendMessage() {
                const message = inputBox.value.trim();
                if (!message) return;
               
                // 添加用戶消息到聊天界面
                addMessageToChat('user', message);
                inputBox.value = '';
                inputBox.style.height = 'auto';
                sendBtn.disabled = true;
               
                // 顯示AI正在輸入
                const loadingId = showLoadingIndicator();
               
                try {
                    // 模擬API請求延遲
                    await new Promise(resolve => setTimeout(resolve, 1000));
                   
                    // 模擬API響應 - 實際應用中替換為真實API調用
                    const response = await simulateStockAPI(message);
                   
                    // 移除加載指示器
                    removeLoadingIndicator(loadingId);
                   
                    // 添加AI回應到聊天界面
                    addMessageToChat('ai', response.answer, response.stockData);
                   
                } catch (error) {
                    removeLoadingIndicator(loadingId);
                    showError('無法取得AI回應：' + error.message);
                }
            }
           
            // 發送按鈕點擊事件
            sendBtn.addEventListener('click', sendMessage);
           
            // 輸入框回車鍵事件
            inputBox.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
           
            // 快速建議點擊事件
            document.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    inputBox.value = this.textContent;
                    inputBox.focus();
                    sendBtn.disabled = false;
                    inputBox.dispatchEvent(new Event('input'));
                });
            });
           
            // 添加消息到聊天界面
            function addMessageToChat(role, content, stockData = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
               
                const avatarIcon = role === 'user' ? 'fas fa-user' : 'fas fa-robot';
               
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-TW', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
               
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="${avatarIcon}"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">${formatMessageContent(content)}</div>
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
               
                chatContainer.appendChild(messageDiv);
               
                // 如果有股票數據，添加到消息中
                if (stockData) {
                    const stockCard = createStockCard(stockData);
                    messageDiv.querySelector('.message-content').insertBefore(
                        stockCard,
                        messageDiv.querySelector('.message-time')
                    );
                }
               
                // 滾動到最新消息
                chatContainer.scrollTop = chatContainer.scrollHeight;
               
                // 隱藏錯誤消息
                errorMessage.style.display = 'none';
            }
           
            // 格式化消息內容
            function formatMessageContent(content) {
                // 簡單的Markdown格式轉換
                content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                content = content.replace(/\*(.*?)\*/g, '<em>$1</em>');
                content = content.replace(/`(.*?)`/g, '<code>$1</code>');
               
                // 將換行符轉換為段落
                content = content.replace(/\n\n/g, '</p><p>');
                content = content.replace(/\n/g, '<br>');
               
                return `<p>${content}</p>`;
            }
           
            // 創建股票卡片
            function createStockCard(stockData) {
                const changeClass = stockData.change >= 0 ? 'positive' : 'negative';
                const changeSymbol = stockData.change >= 0 ? '+' : '';
               
                const card = document.createElement('div');
                card.className = 'stock-card';
                card.innerHTML = `
                    <div class="stock-header">
                        <div>
                            <div class="stock-name">${stockData.name}</div>
                            <div class="stock-ticker">${stockData.ticker}</div>
                        </div>
                        <div>
                            <div class="stock-price">$${stockData.price.toFixed(2)}</div>
                            <div class="stock-change ${changeClass}">
                                ${changeSymbol}${stockData.change.toFixed(2)}%
                                (${changeSymbol}${(stockData.price * stockData.change / 100).toFixed(2)})
                            </div>
                        </div>
                    </div>
                    <div class="stock-details">
                        <div class="detail-item">
                            <div class="detail-label">市值</div>
                            <div class="detail-value">$${formatNumber(stockData.marketCap)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">本益比 (P/E)</div>
                            <div class="detail-value">${stockData.peRatio.toFixed(2)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">股息率</div>
                            <div class="detail-value">${stockData.dividendYield.toFixed(2)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">52週範圍</div>
                            <div class="detail-value">$${stockData.range52w.low.toFixed(2)} - $${stockData.range52w.high.toFixed(2)}</div>
                        </div>
                    </div>
                `;
               
                return card;
            }
           
            // 顯示加載指示器
            function showLoadingIndicator() {
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message ai';
                loadingDiv.id = 'loading-' + Date.now();
               
                loadingDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="loading-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
               
                chatContainer.appendChild(loadingDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
               
                return loadingDiv.id;
            }
           
            // 移除加載指示器
            function removeLoadingIndicator(id) {
                const loadingDiv = document.getElementById(id);
                if (loadingDiv) {
                    loadingDiv.remove();
                }
            }
           
            // 顯示錯誤消息
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
               
                // 5秒後自動隱藏錯誤消息
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }
           
            // 格式化大數字
            function formatNumber(num) {
                if (num >= 1e12) {
                    return (num / 1e12).toFixed(2) + 'T';
                }
                if (num >= 1e9) {
                    return (num / 1e9).toFixed(2) + 'B';
                }
                if (num >= 1e6) {
                    return (num / 1e6).toFixed(2) + 'M';
                }
                return num.toFixed(2);
            }
           
            // 模擬股票API
            function simulateStockAPI(question) {
                return new Promise((resolve, reject) => {
                    // 10%概率模擬失敗
                    if (Math.random() < 0.1) {
                        reject(new Error('API請求超時'));
                        return;
                    }
                   
                    // 從問題中提取股票名稱或代碼
                    const stockMatch = question.match(/([A-Za-z]+|\d+)/);
                    const stockSymbol = stockMatch ? stockMatch[0] : 'TSM';
                   
                    // 根據問題生成模擬回答
                    const answers = {
                        "財務": `
                            **${getStockName(stockSymbol)}(${stockSymbol}) 財務分析**
                           
                            根據最新財報：
                            - **營收**: $${(Math.random() * 50 + 10).toFixed(2)}B，同比${Math.random() > 0.5 ? '增長' : '下降'}${(Math.random() * 15 + 5).toFixed(1)}%
                            - **淨利潤**: $${(Math.random() * 10 + 2).toFixed(2)}B，利潤率${Math.random() > 0.5 ? '提升' : '下降'}至${(Math.random() * 15 + 10).toFixed(1)}%
                            - **每股收益(EPS)**: $${(Math.random() * 5 + 1).toFixed(2)}，${Math.random() > 0.5 ? '高於' : '低於'}分析師預期
                           
                            財務狀況整體${Math.random() > 0.5 ? '穩健' : '面臨挑戰'}，${Math.random() > 0.5 ? '現金流充足' : '負債比率需關注'}。
                        `,
                        "技術": `
                            **${getStockName(stockSymbol)}(${stockSymbol}) 技術分析**
                           
                            當前技術指標顯示：
                            - **RSI(14)**: ${(Math.random() * 30 + 40).toFixed(1)}，${Math.random() > 0.5 ? '中性' : Math.random() > 0.5 ? '接近超買' : '接近超賣'}區域
                            - **MACD**: ${Math.random() > 0.5 ? '金叉' : '死叉'}信號，${Math.random() > 0.5 ? '看漲' : '看跌'}動能
                            - **支撐位**: $${(Math.random() * 50 + 100).toFixed(2)}
                            - **阻力位**: $${(Math.random() * 50 + 150).toFixed(2)}
                           
                            短期趨勢${Math.random() > 0.5 ? '偏多' : '偏空'}，${Math.random() > 0.5 ? '突破關鍵阻力可望續漲' : '需警惕回調風險'}。
                        `,
                        "競爭": `
                            **${getStockName(stockSymbol)} 競爭優勢分析**
                           
                            在${getIndustry(stockSymbol)}行業中：
                            - 市佔率約${(Math.random() * 30 + 20).toFixed(1)}%，${Math.random() > 0.5 ? '領先' : '落後於'}主要競爭對手
                            - 核心優勢：${getRandomStrength()}
                            - 面臨挑戰：${getRandomChallenge()}
                           
                            未來${Math.random() > 0.5 ? '隨著' + getTrend() + '，競爭地位有望提升' : '需警惕' + getRisk() + '帶來的衝擊'}。
                        `,
                        "預測": `
                            **${getStockName(stockSymbol)} 未來12個月預測**
                           
                            分析師共識：
                            - **目標價**: $${(Math.random() * 100 + 150).toFixed(2)}，${Math.random() > 0.5 ? '上調' : '下調'}評級
                            - **評級**: ${getRandomRating()}
                            - **潛在回報**: ${Math.random() > 0.5 ? '+' : ''}${(Math.random() * 30 + 5).toFixed(1)}%
                           
                            關鍵驅動因素：
                            1. ${getDriver()}
                            2. ${getDriver()}
                           
                            風險因素：
                            1. ${getRisk()}
                            2. ${getRisk()}
                        `
                    };
                   
                    // 判斷問題類型
                    let answerType = "預測";
                    if (question.includes("財務") || question.includes("營收") || question.includes("利潤")) {
                        answerType = "財務";
                    } else if (question.includes("技術") || question.includes("K線") || question.includes("指標")) {
                        answerType = "技術";
                    } else if (question.includes("競爭") || question.includes("優勢") || question.includes("比較")) {
                        answerType = "競爭";
                    }
                   
                    const answer = answers[answerType] || answers["預測"];
                   
                    // 生成隨機股票數據
                    const basePrice = Math.random() * 500 + 50;
                    const change = (Math.random() * 8 - 4);
                   
                    resolve({
                        answer: answer,
                        stockData: {
                            name: getStockName(stockSymbol),
                            ticker: stockSymbol,
                            price: basePrice,
                            change: change,
                            marketCap: Math.random() * 500e9 + 50e9,
                            peRatio: Math.random() * 30 + 10,
                            dividendYield: Math.random() * 5,
                            range52w: {
                                low: basePrice * 0.7,
                                high: basePrice * 1.3
                            }
                        }
                    });
                });
            }
           
            // 輔助函數 - 獲取股票名稱
            function getStockName(symbol) {
                const stocks = {
                    "2330": "台積電",
                    "2454": "聯發科",
                    "2317": "鴻海",
                    "2303": "聯電",
                    "1301": "台塑",
                    "1303": "南亞",
                    "TSM": "台積電",
                    "AAPL": "蘋果",
                    "MSFT": "微軟",
                    "GOOGL": "谷歌",
                    "AMZN": "亞馬遜",
                    "NVDA": "輝達"
                };
                return stocks[symbol] || symbol + "公司";
            }
           
            // 輔助函數 - 獲取行業
            function getIndustry(symbol) {
                const industries = ["半導體", "電子製造", "雲計算", "軟體服務", "電動車", "金融", "消費品", "醫療保健"];
                return industries[Math.floor(Math.random() * industries.length)];
            }
           
            // 輔助函數 - 隨機優勢
            function getRandomStrength() {
                const strengths = [
                    "技術領先優勢",
                    "規模經濟效應",
                    "品牌價值高",
                    "專利壁壘",
                    "客戶忠誠度高",
                    "成本控制能力強",
                    "分銷網絡完善"
                ];
                return strengths[Math.floor(Math.random() * strengths.length)];
            }
           
            // 輔助函數 - 隨機挑戰
            function getRandomChallenge() {
                const challenges = [
                    "新競爭者進入",
                    "技術迭代風險",
                    "供應鏈不穩定",
                    "監管政策變化",
                    "市場飽和",
                    "原材料成本上升",
                    "人才短缺"
                ];
                return challenges[Math.floor(Math.random() * challenges.length)];
            }
           
            // 輔助函數 - 隨機趨勢
            function getTrend() {
                const trends = [
                    "產業升級",
                    "數字化轉型",
                    "全球供應鏈重組",
                    "ESG投資趨勢",
                    "政策支持",
                    "消費模式改變",
                    "技術創新"
                ];
                return trends[Math.floor(Math.random() * trends.length)];
            }
           
            // 輔助函數 - 隨機驅動因素
            function getDriver() {
                const drivers = [
                    "新產品發布",
                    "市場份額擴大",
                    "成本優化措施",
                    "國際市場拓展",
                    "併購整合效應",
                    "技術突破",
                    "行業復甦"
                ];
                return drivers[Math.floor(Math.random() * drivers.length)];
            }
           
            // 輔助函數 - 隨機風險
            function getRisk() {
                const risks = [
                    "經濟衰退",
                    "地緣政治緊張",
                    "匯率波動",
                    "庫存過高",
                    "產品延遲",
                    "管理層變動",
                    "技術落後"
                ];
                return risks[Math.floor(Math.random() * risks.length)];
            }
           
            // 輔助函數 - 隨機評級
            function getRandomRating() {
                const ratings = [
                    "強力買入",
                    "買入",
                    "持有",
                    "減持",
                    "賣出"
                ];
                return ratings[Math.floor(Math.random() * ratings.length)];
            }
        });
    </script>
</body>
</html>