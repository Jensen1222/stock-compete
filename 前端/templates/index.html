<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è™›æ“¬è‚¡ç¥¨æŠ•è³‡ç³»çµ±</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
{% if current_user.is_authenticated %}
  <div class="account-info">
    ğŸ‘¤ å¸³è™Ÿï¼š<strong>{{ current_user.username }}</strong>
    <a href="{{ url_for('logout') }}">ç™»å‡º</a>
  </div>
{% endif %}

<div class="container">
  <h1>è™›æ“¬è‚¡ç¥¨æŠ•è³‡ç³»çµ±</h1>

  <div class="card">
    <h2>ğŸ“ æŠ•è³‡å€‹æ€§å•å·</h2>
    <p>å®Œæˆç°¡å–®äº”é¡Œå•å·ï¼Œäº†è§£ä½ çš„æŠ•è³‡é¢¨æ ¼ä¸¦ç²å¾—å»ºè­°ã€‚</p>
    <button class="buy-btn" onclick="window.open('/quiz', '_blank')">é–‹å§‹å•å·æ¸¬é©—</button>
  </div>

  <div class="card">
    <h2>ğŸ“Š æ’è¡Œæ¦œ</h2>
    <p>æŸ¥çœ‹æ‰€æœ‰ä½¿ç”¨è€…çš„ç¸½è³‡ç”¢æ’è¡Œã€‚</p>
    <button class="buy-btn" onclick="window.location.href='/ranking'">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
  </div>

  <div class="card balance-card">
    <div>
      <h2>ç›®å‰é¤˜é¡ï¼š<span id="balance">$0.00</span></h2>
      <h2 style="margin-top: 10px;">ç¸½è³‡ç”¢ï¼š<span id="total-assets">$0.00</span></h2>
    </div>
  </div>

<!-- æ•´è‚¡äº¤æ˜“å€ -->
<div class="card">
  <h2>æ•´è‚¡äº¤æ˜“å€</h2>
  <div class="input-group">
    <label for="ticker">è‚¡ç¥¨ä»£è™Ÿï¼š</label>
    <input type="text" id="ticker" placeholder="ä¾‹å¦‚ï¼š2330" required>
  </div>
  <div class="input-group">
    <label for="quantity">æ•¸é‡ï¼ˆå¼µï¼‰ï¼š</label>
    <input type="number" id="quantity" placeholder="ä¾‹å¦‚ï¼š10" required>
  </div>
  <div class="input-group">
    <button class="buy-btn" onclick="buyStock()">è²·å…¥</button>
    <button class="sell-btn" onclick="sellStock()">è³£å‡º</button>
  </div>
</div>

<!-- é›¶è‚¡äº¤æ˜“å€ -->
<div class="card">
  <h2>é›¶è‚¡äº¤æ˜“å€</h2>
  <div class="input-group">
    <label for="ticker-lot">è‚¡ç¥¨ä»£è™Ÿï¼š</label>
    <input type="text" id="ticker-lot" placeholder="ä¾‹å¦‚ï¼š2330" required>
  </div>
  <div class="input-group">
    <label for="quantity-lot">è‚¡æ•¸ï¼ˆ1ï½999ï¼‰ï¼š</label>
    <input type="number" id="quantity-lot" min="1" max="999" placeholder="ä¾‹å¦‚ï¼š30" required>
  </div>
  <div class="input-group">
    <button id="buy-lot-btn" type="button" class="buy-btn">è²·å…¥é›¶è‚¡</button>
    <button id="sell-lot-btn" type="button" class="sell-btn">è³£å‡ºé›¶è‚¡</button>
  </div>
</div>




  <!-- âœ… æ•´åˆå¾Œçš„ã€Œè‚¡ç¥¨æŸ¥è©¢èˆ‡è¶¨å‹¢åœ–ã€ -->
  <div class="card">
    <h2>ğŸ“ˆ è‚¡ç¥¨æŸ¥è©¢èˆ‡è¶¨å‹¢åœ–</h2>

    <div class="input-group">
      <label for="queryTicker">è‚¡ç¥¨ä»£ç¢¼</label>
      <input type="text" id="queryTicker" placeholder="ä¾‹å¦‚ï¼š2330" />
    </div>

    <div class="input-group" style="margin-top: 10px;">
      <button class="buy-btn" onclick="queryTaiwanStock()">æŸ¥è©¢</button>
    </div>

    <p id="currentPrice" style="margin-top: 10px;"></p>
    <canvas id="chart" width="400" height="200"></canvas>
  </div>

<div class="card">
  <h2>TradingView å³æ™‚åœ–è¡¨</h2>

  <div style="margin-bottom: 10px;">
    <input type="text" id="symbolInput" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼Œä¾‹å¦‚ AAPLã€TSLAã€2330">
    <p style="color: #94a3b8; font-size: 14px;">å°è‚¡ä»£ç¢¼å°‡è‡ªå‹•åœ¨æ–°åˆ†é é–‹å•Ÿ TradingView å®˜ç¶²</p>
    <button onclick="updateChart()">æ›´æ–°åœ–è¡¨</button>
  </div>

  <div id="iframe-container"></div>
</div>

<script>
function updateChart() {
  let symbol = document.getElementById("symbolInput").value.trim();

  // åˆ¤æ–·æ˜¯å¦ç‚ºç´”æ•¸å­—ï¼ˆå°è‚¡ä»£ç¢¼ï¼‰ â†’ é–‹æ–°é é¢è·³è½‰åˆ° TradingView
  if (/^[0-9]{4}$/.test(symbol)) {
    window.open(`https://tw.tradingview.com/symbols/TWSE-${symbol}/`, "_blank");
    return;
  }

  // å…¶é¤˜ç¾è‚¡æˆ–åŠ å¯†å¹£ â†’ ç”¨ iframe é¡¯ç¤º
  const container = document.getElementById("iframe-container");
  container.innerHTML = `
    <iframe
      src="https://s.tradingview.com/widgetembed/?symbol=${symbol}&interval=D&theme=dark&style=1&locale=zh_TW"
      width="100%"
      height="500"
      frameborder="0"
      allowtransparency="true"
      scrolling="no">
    </iframe>`;
}

// é è¨­è¼‰å…¥ AAPL
window.onload = function () {
  document.getElementById("symbolInput").value = "AAPL";
  updateChart();
};
</script>






  <div class="card">
    <h2>æŠ•è³‡çµ„åˆ</h2>
    <table id="portfolio-table">
      <thead>
      <tr>
    <th>ä»£ç¢¼</th>
    <th>æ•¸é‡</th>
    <th>æˆæœ¬åƒ¹</th>
    <th>å¸‚åƒ¹</th>
    <th>å¸‚å€¼</th>
    <th>æç›Š</th> 
     </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card">
  <h2>äº¤æ˜“ç´€éŒ„</h2>
  <p>æŸ¥çœ‹ä½ æ‰€æœ‰è²·å…¥å’Œè³£å‡ºçš„ç´€éŒ„</p>
  <button class="buy-btn" onclick="window.location.href='/trades'">æŸ¥çœ‹äº¤æ˜“ç´€éŒ„</button>
</div>

  <div class="card">
    <h2>aiæŠ•è³‡å•é¡Œ</h2>
    <p>ç›¸é—œæŠ•è³‡å•é¡Œã€‚</p>
    <button class="buy-btn" onclick="window.location.href='/ai'">aiæŠ•è³‡å•é¡Œ</button>
  </div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>

<script>
let historyChart;

function queryTaiwanStock() {
  const ticker = document.getElementById("queryTicker").value.trim();
  if (!ticker) return alert("è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼");

  // å³æ™‚åƒ¹æ ¼
  fetch(`/price?ticker=${ticker}`)
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        document.getElementById("currentPrice").textContent =
          `${ticker} ç•¶å‰åƒ¹æ ¼ç‚ºï¼š$${data.price}`;
      } else {
        document.getElementById("currentPrice").textContent = `æŸ¥ç„¡å³æ™‚åƒ¹æ ¼ï¼š${data.message}`;
      }
    });

  // æ­·å²åƒ¹æ ¼è¶¨å‹¢åœ–
  fetch(`/history?ticker=${ticker}`)
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        const labels = data.data.map(d => d.Date);
        const prices = data.data.map(d => d.Close);
        const ctx = document.getElementById("chart").getContext("2d");

        if (historyChart) {
          historyChart.data.labels = labels;
          historyChart.data.datasets[0].data = prices;
          historyChart.data.datasets[0].label = `${ticker} éå»30å¤©`;
          historyChart.update();
        } else {
          historyChart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [{
                label: `${ticker} éå»30å¤©`,
                data: prices,
                borderColor: "#00c853",
                fill: false
              }]
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  title: {
                    display: true,
                    text: 'æ—¥æœŸ'
                  }
                },
                y: {
                  title: {
                    display: true,
                    text: 'æ”¶ç›¤åƒ¹'
                  }
                }
              }
            }
          });
        }
      } else {
        alert("æŸ¥è©¢æ­·å²åƒ¹æ ¼å¤±æ•—ï¼š" + data.message);
      }
    })
    .catch(err => {
      console.error("æŸ¥è©¢éŒ¯èª¤", err);
      alert("æŸ¥è©¢éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤");
    });
    
}


</script>

</body>
</html>
